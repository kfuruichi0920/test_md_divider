# GEMINI.md

## 1. アプリケーション仕様書

### 1.1. プロジェクト概要
本アプリケーションは、Electron、React、TypeScriptで構築されたデスクトップアプリケーションです。指定されたテキストファイル（`.txt`, `.md`）を読み込み、段落ごとに「カード」として分割します。ユーザーはこれらのカードを視覚的に管理、編集、状態変更、並び替えができ、その作業状態をJSONファイルとして保存・読み込みすることが可能です。

### 1.2. 機能要件

#### 1.2.1. ファイル操作
- **読み込み**:
  - テキストファイル（`.txt`, `.md`）および状態保存用のJSONファイル（`.json`）に対応。
  - ファイルは、画面へのドラッグ＆ドロップ、またはファイル選択ダイアログから開くことが可能。
- **保存**:
  - 現在のカードの状態（内容、順序、ステータス等）をJSON形式でファイルに保存する。
  - 元のテキストファイルは一切変更しない。

#### 1.2.2. テキスト処理
- **段落分割**:
  - 読み込んだテキストファイルを、連続する改行（`\n\n`）を区切りとして段落に分割する。
  - 分割時、空行のみの段落は除外し、各段落の先頭と末尾の空白文字は除去する。

#### 1.2.3. カード管理
- **カードのライフサイクル**:
  - 分割された各段落から「カード」オブジェクトを生成し、リストとして管理する。
- **編集**:
  - カードのテキスト内容は、ダブルクリックによるインライン編集が可能。
  - 編集内容は自動で保存される。
- **状態管理**:
  - 各カードは「未処理」「処理中」「処理済み」のいずれかの状態を持つ。
  - 状態はユーザーが任意に変更可能。
- **並び替え**:
  - 各カードに表示される「▲▼」ボタン、またはカード番号のドラッグ＆ドロップにより、リスト内の順序を自由に変更できる。
- **フィルタリング**:
  - カードの状態（未処理、処理中、処理済み）や、カードのテキスト内容（キーワード検索）によって、表示するカードを絞り込むことができる。

#### 1.2.4. データ永続化と復元
- **初期情報の保持**:
  - テキストファイルから読み込んだ時点のカード内容を「初期情報（`originalContent`）」として常に保持する。
  - テキストが編集されると、初期情報とは別に「更新情報（`content`）」として保持する（更新は1世代のみ）。
- **JSONによる状態管理**:
  - カードの全情報（編集内容、順序、状態、各種タイムスタンプ）をJSONファイルに保存できる。
  - JSONファイルを読み込むことで、以前の作業状態を完全に復元する。
  - 読み込み時にはJSONデータの妥当性チェック（Validation）が行われ、結果はステータスログに表示される。

#### 1.2.5. UI/UX
- **設定**:
  - カードに表示されるフォントの種類と文字サイズをユーザーが選択・変更できる。
- **ステータスログ**:
  - 画面下部に操作ログ（ファイルの読み書き、バリデーション結果、カード操作など）を表示する。
  - このログ領域は、ユーザーがドラッグで高さを自由に変更できる。

### 1.3. データモデル仕様

#### 1.3.1. カードオブジェクトの構成
各カードは以下の情報を持ちます。
- `id`: カードの一意な識別子
- `content`: 編集可能な現在のテキスト内容
- `originalContent`: ファイルから読み込んだ初期のテキスト内容
- `hasChanges`: `content`が`originalContent`から変更されたかを示すフラグ（真偽値）
- `status`: カードの状態（`UNPROCESSED`, `PROCESSING`, `PROCESSED`）
- `originalPosition`: ファイル内での初期の連番
- `displayOrder`: 現在の表示順序。並び替え時に再計算される
- `createdAt`: カードの作成時刻
- `updatedAt`: カード内容の最終更新時刻
- `statusUpdatedAt`: カード状態の最終更新時刻（初期の「未処理」状態では空）

### 1.4. UI/UX仕様

- **レイアウト**:
  - **ツールバー（3段構成）**:
    1.  **上段**: ファイル操作（テキストを開く、JSONを開く/保存する）
    2.  **中段**: 現在開いているファイルのパス情報
    3.  **下段**: フィルター（状態、内容検索）、設定（フォント、文字サイズ）
  - **メインエリア**: カードが縦に並ぶ仮想スクロールリスト
  - **フッター**: リサイズ可能なステータスログパネル
- **カードの視覚表現**:
  - **高さ**: カードの高さは、表示内容がすべて収まるように自動で調整される。
  - **状態**: 状態ごとに色分けされ、視覚的に識別しやすい。
  - **変更**:
    - 内容が変更されたカードには、変更済みを示すバッジが表示される。
    - **現在の内容 (`content`)**: `originalContent` との差分のうち、**追加された部分が赤字**でハイライト表示される。
    - **初期内容 (`originalContent`)**: `content` との差分のうち、**削除された部分が青字の打ち消し線付き**でハイライト表示され、どこが変更されたか視覚的に確認できる。
  - **順序**: `現在位置 (元: 元位置)` の形式で番号が表示される。
  - **時刻**: 作成（グレー）、更新（青）、状態更新（緑）の3種類の時刻が色分けされて表示される。

### 1.5. 技術・非機能要件

- **技術スタック**: Electron / React / TypeScript
- **対応ファイル形式**:
  - **入力**: テキストファイル (`.txt`, `.md`)、JSON (`.json`)
  - **エンコーディング**: UTF-8
  - **最大ファイルサイズ**: 10MB
- **性能要件**:
  - **最大カード数**: 10,000件を快適に操作可能。
  - **表示応答性**: 仮想スクロール（`VariableSizeList`）の採用により、大量のカードがあっても100ms以内の高速な表示応答を実現する。

## 2. 開発情報

### 2.1. 開発コマンド
- `npm install`: 依存関係のインストール
- `npm start`: 開発サーバー起動
- `npm run build`: プロダクションビルド
- `npm run electron`: Electronアプリ起動
- `npm test`: テスト実行

### 2.2. アーキテクチャ概要
- **Main Process**: Electronのメインプロセス。ファイル操作とウィンドウ管理を担う。
- **Renderer Process**: ReactベースのUI。画面表示とユーザー操作を担う。
- **Card Manager**: カードオブジェクトの管理とビジネスロジックを担う。
- **Text Processor**: ファイル読み込みと段落分割処理を担う。
- **Virtual List**: 大量データ表示のための仮想スクロールコンポーネント。

### 2.3. プロジェクト構成
```
src/
  main/           # Electronメインプロセス関連のソースコード
  renderer/       # ReactコンポーネントなどUI関連のソースコード
  models/         # データモデル（Card, SaveDataなど）
  services/       # ビジネスロジック（CardManager, SaveDataManagerなど）
  utils/          # ユーティリティ関数（TextProcessorなど）
```

### 2.4. 改修時のルール
- 変更を行った場合は、ドキュメント（本ファイルなど）も併せてメンテナンスする。
- コミットメッセージは日本語で行う。