# CLAUDE.md

以下の要件のソフトウェアを作成します。

1. 機能要件

 - 指定したファイルを読み込みます。
 - 段落ごとに文書を分割します。
 - 分割した文書をカードオブジェクトとして管理します。
 - カードオブジェクトは、状態、文書中の位置、分割した文書、を持ちます。
 - カードオブジェクトの状態は、未処理、処理中、処理済みのいずれかです。
 - カードオブジェクトの文書中の位置は、先頭からの連番とします。
 - カードオブジェクトを画面表示します。
 - カードオブジェクトを選択し、状態、文書中の位置、分割した文書をそれぞれ編集可能とします。

2. 非機能要件
 - カードオブジェクトが大量に存在する場合でも、快適に操作できること。

3. 技術スタック
 - electronで作成します。

4. UI/UX要件（追加）
 - ファイル選択：ドラッグ&ドロップまたはファイルダイアログ
 - カード表示：縦スクロール可能なリスト形式
 - 編集UI：インライン編集（ダブルクリックで編集モード）
 - 状態表示：色分けによる視覚的な状態表示

5. ファイル形式要件（追加）
 - 対応形式：テキストファイル（.txt, .md）
 - エンコーディング：UTF-8
 - 最大ファイルサイズ：10MB

6. 段落分割仕様（追加）
 - 区切り文字：連続する改行（\n\n）
 - 空行のみの段落は除外
 - 先頭・末尾の空白文字は除去

7. データ永続化（追加）
 - カード状態はメモリ上で管理（セッション単位）
 - 編集内容の自動保存
 - 元ファイルの変更は行わない

8. 性能要件詳細（追加）
 - 最大カード数：10,000件
 - カード表示応答時間：100ms以内
 - 仮想スクロールによる大量データ対応

## 開発コマンド
- `npm install` - 依存関係のインストール
- `npm start` - 開発サーバー起動
- `npm run build` - プロダクションビルド
- `npm run electron` - Electronアプリ起動
- `npm test` - テスト実行

## アーキテクチャ概要
- **Main Process**: Electronのメインプロセス、ファイル操作とウィンドウ管理
- **Renderer Process**: Reactベースの画面表示とユーザー操作
- **Card Manager**: カードオブジェクトの管理とビジネスロジック
- **Text Processor**: ファイル読み込みと段落分割処理
- **Virtual List**: 大量データ表示のための仮想スクロール

## プロジェクト構成
```
src/
  main/           # Electronメインプロセス
  renderer/       # React UIコンポーネント
  models/         # データモデル
  services/       # ビジネスロジック
  utils/          # ユーティリティ関数
```

## 改修時のルール
 - 変更を行った場合は、ドキュメントも併せてメンテナンスする。
 - commitメッセージは日本語でおこなう。


## 機能追加1 ✅ 完了
  [修正]画面上部のフィルター(状態、内容検索)を操作しても、カードがフィルタされない問題を修正する。
  [追加]入力ファイル毎に、json形式でカード状態を保存する。
  [追加]よって新規にファイル読み込みと、jsonファイルを読み込みに対応する。
  [追加]jsonファイルは、手動でも編集可能とし、毎回読み込み時にvalidationチェックを行う。
  [追加]画面下にはステータスログを表示させ、json読み込み時のvalidationチェック結果を表示する。
  [追加]jsonファイルの読み込み開始、validation結果、読み込み結果完了、操作ログをステータスログとして表示する。

### 実装詳細
- **フィルター修正**: AppContextのuseEffectでフィルター変更時に自動更新
- **JSON保存**: SaveDataManagerでバージョン管理・メタデータ付きのJSON形式
- **JSON読み込み**: バリデーション機能付きで、エラー・警告をログ表示
- **ステータスログ**: LogLevel別の色分け表示（INFO/SUCCESS/WARNING/ERROR）
- **操作ログ**: ファイル操作・カード更新・JSON処理の詳細ログ記録
- **UI改善**: ツールバーにJSON保存・読み込みボタンを追加

### 新規コンポーネント
- `SaveDataManager`: JSON保存データの管理
- `StatusLog`: ログ表示コンポーネント
- `SaveData`: 保存データの型定義

## 機能追加2 ✅ 完了
  [修正]JSONファイルを手動編集後、「JSONファイルを開く」とすると、編集したカードが表示されない。表示されるようにする。
  [修正]もしエラーが発生しているのであれば、ステータスログとして表示する。
  [修正]ステータスログが初回のファイル読み込みしか表示されないので、以降の操作も記録できるようにする。
  [修正]ステータスログの領域は広げることができるようにする。
  [修正]画面上部のフィルター(状態、内容検索)が途中で改行される場合があるので、1段目はファイル操作、2段目にフィルタ操作のUI配置とする。

### 実装詳細
- **JSON表示修正**: loadJsonFile後にupdateCardsList()を明示的に呼び出し
- **エラーログ改善**: 既存のエラーハンドリングでステータスログ表示済み
- **継続ログ機能**: アプリ起動時・フィルター操作時のログ記録を追加
- **リサイザー実装**: ドラッグ操作によるステータスログ領域の高さ調整
- **2段階UI**: ファイル操作（1段目）とフィルター操作（2段目）に分離

### UI改善点
- リサイザーハンドルの視覚的フィードバック
- 動的なツールバー高さ調整
- アイコン付きボタンとラベル
- 操作ログの詳細記録